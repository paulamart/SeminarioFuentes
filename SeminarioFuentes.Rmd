---
title: "Seminario Fuentes de  Biómédicas y Web Semántica"
author: "Javier Sáez García y Paula Martínez Terrados"
date: "2022-11-08"
output: html_document
---

# Índice de contenidos
1. Introducción
2. Objetivos
3. Métodos
4. Desarrollo y Resultados
5. Conclusiones finales

## 1. Introducción
En este proyecto de seminario, trataremos de analizar los datos, respecto al sexo y a cada comunidad autónoma, de la tasa de paro nacional desde el año 2006 hasta el año 2021. A su vez, el seminario tratará de analizar los datos, respecto al sexo y a cada comunidad autónoma, del suicidio en España a lo largo de los años 2016, 2017, 2018, 2019 y 2020.
Posteriormente, tras analizar y estructurar adecuadamente los datos, trataremos de ver la relación, si la hay, entre estos dos aspectos, es decir, trataremos de determinar si hay una relación entre la tasa de paro de una comunidad autónoma, y la cantidad de suicidios que se producen en la misma.

## 2. Objetivos
El desarrollo del seminario se basa en la resolución y/o respuesta de una serie de objetivos bien marcados desde el inicio del proyecto:

1. VARIACIÓN DE PARO RESPECTO AL SEXO POR AÑOS
   VARIACIÓN DE SUICIDIO RESPECTO AL SEXO POR AÑOS
2. VARIACION DE PARO RESPECTO A LOS AÑOS, AL SEXO Y A COMUNIDAD AUTONOMA
   VARIACION DE SUICIDIOS RESPECTO A LOS AÑOS, AL SEXO Y A COMUNIDAD AUTONOMA
3. VER SI EXISTE O NO RELACIÓN ENTRE LA CANTIDAD DE PARO, Y EL NÚMERO DE SUICIDIOS

## 3. Métodos utilizados
Durante el desarrollo y estudio del seminario, hemos utilizado numerosas librerías, entre las que cabe destacar:

1. library(readr)

Utilizamos readr para importar los datos extraídos de la base de datos del gobierno de España (gob.es). (Dichos datos están disponibles en la carpeta input/data del repositorio Github).

2. library(dplyr)

Utilizamos dplyr para modificar y filtrar los datos, y obtener así sólo aquellos que fueran de gran interés para ayudarnos a contestar las preguntas que propusimos antes de comenzar el proyecto.

3. library(ggplot2)

Utilizamos ggplot2 para representar de forma visual, mediante gráficos de todo tipo, los datos. 

## 4. Desarrollo 
Antes de empezar el seminario, tuvimos que decidir qué datos utilizar y dónde buscarlos. Tras un tiempo, decidimos recoger ambos sets de datos de la base de datos del gobierno de España (gob.es).
Concretamente, los datos de tasa de paro los obtivimos de la siguiente fotografía:

![Imagen 1. Fotográfia datos de tasa de paro](input/images/Datos.gob_Tasa_de_Paro.png)


Por otro lado, los datos de suicidio los sacamos de la fotografía que se muestra a continuación:


![Imagen 2. Fotografía datos de suicidio](input/images/Datos.gob_Suicidios.png)


Posteriormente, insertamos los datos en el proyecto, para poder estudiarlos y modificarlos de cara a los objetivos propuestos.
Para la tasa de paro, importamos los datos de la siguiente manera:
```{r , eval = FALSE}
library(readr)
Tasa_de_Paro <- read_delim("input/data/Tasa_de_Paro.csv", 
                           delim = ";", escape_double = FALSE, 
                           col_types = cols(Total = col_double()), 
                           trim_ws = TRUE)
```
Por otro lado, para los datos de suicidio, tuvimos que importarlo de la siguiente forma:
```{r , eval = FALSE}
library(readr)
Suicidio <- read_delim("input/data/Suicidio.csv", 
                       delim = ";", escape_double = FALSE, 
                       col_types = cols(Total = col_double()), 
                       trim_ws = TRUE)
```


Una vez teníamos los datos importados en el proyecto, procedimos a filtrarlos para que mostraran sólo aquella información que fuera de utilidad para el proyecto. Para poder llegar a los objetivos propuestos, tuvimos que modificar ambos sets de datos.

De cara a conseguir el primero objetivo de VARIACIÓN DE PARO RESPECTO AL SEXO POR AÑOS, tuvimos que modificar el set de datos respectivo a la tasa de paro, de la siguiente forma:

1. Cambiamos el nombre de las comunidades y ciudades autónomas, para poder eliminar los números que aparecían al lado de cada comunidad autónoma, y añadimos los nuevos nombres, a una columna nueva del set de datos, que llamaremos CCAA.
Para ello tuvimos que utilizar case_when:
```{r , eval = FALSE}
library(dplyr)
Tasa_de_Paro <- Tasa_de_Paro%>%
  mutate(
    CCAA = case_when( ## cambiamos el nombre con un case_When
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "01 Andalucía" ~ "Andalucia",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "02 Aragón" ~ "Aragon",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "03 Asturias. Principado de" ~ "Asturias",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "04 Balears. Illes" ~ "Baleares",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "05 Canarias" ~ "Canarias",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "06 Cantabria" ~ "Cantabria",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "07 Castilla y León" ~ "CyL",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "08 Castilla - La Mancha" ~ "Castilla la Mancha",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "09 Cataluña" ~ "Cataluña",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "10 Comunitat Valenciana" ~ "C.Valencia",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "11 Extremadura" ~ "Extremadura",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "12 Galicia" ~ "Galicia",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "13 Madrid. Comunidad de" ~ "Madrid",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "14 Murcia. Región de" ~ "Murcia",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "15 Navarra. Comunidad Foral de" ~ "Navarra",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "16 País Vasco" ~ "País Vasco",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "17 Rioja. La" ~ "La Rioja",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "18 Ceuta" ~ "Ceuta",
      Tasa_de_Paro$`Comunidades y Ciudades Autónomas`== "19 Melilla" ~ "Melilla",
    )) ## y definimos que los nombres "antiguos", van a tener un "nuevo" nombre
```


2. Filtramos los datos para que nos salieran sólo aquellos datos que nos mostraran hombres y mujeres, ambos por separado, eliminando así aquellos datos que contenían una línea para "ambos sexos". Hicimos esto porque, para los objetivos que nos propusimos, era primordial filtrar por sexos, para, posteriormente estudiar, si hubieran, las diferencias entre ambos.
```{r , eval = FALSE}
library(dplyr)
Tasa_de_Paro <-
  Tasa_de_Paro %>%
  mutate(Sexo = factor(Sexo)) %>%
  filter(Sexo != "Ambos sexos") %>%
  droplevels()

## para ver qué niveles de sexo tiene ahora el set de datos
levels(Tasa_de_Paro$Sexo)
## sólo tendrá Hombres y Mujeres, porque hemos eliminado la categoría "ambos sexos" ya que no es objeto de estudio
## (comprobamos que la categoria "ambos sexos", ha desaparecido)
Tasa_de_Paro %>%
  filter(Sexo != "Ambos sexos") %>%
  levels() ## nos sale NULL porque ha desaparecido

```


3. Seguidamente, filtramos los datos anteriores, para que nos muestre sólo aquellos valores para los que la nacionalidad es "total", ya que no es objetivo de estudio de nuestro seminario distinguir entre el paro de España respecto a las nacionalidades de las personas.

```{r , eval = FALSE}
Tasa_de_Paro <-
  Tasa_de_Paro %>%
  mutate(Nacionalidad = Tasa_de_Paro$Nacionalidad) %>%
  filter(Nacionalidad == "Total") %>%
  droplevels()
```

Una vez tenemos los datos correctamente filtrados, nos pusimos a realizar la gráfica que nos sayudara a conseguir el objetivo inicialmente propuesto:

Para la variación del paro respecto al sexo a lo largo de los años, necesitamos un gráfico que muestre cómo varía el paro nacional respecto al sexo y respecto al paso del tiempo.
Para ello propusimos lo siguiente:
```{r , eval = FALSE}
Plot_Paro_Sexo_Años <- ## necesitamos guardarlo con un nombre determinado
  ggplot(data = Paro_Total_Año, aes(x = Periodo, y = Total)) +
  geom_point(aes(colour = factor(Sexo))) +
  theme_light() +
  geom_smooth(method = "lm", aes(colour = factor(Sexo))) +
  theme_classic()

Plot_Paro_Sexo_Años

```

![Imagen 3. Gráfico del paro respecto al sexo a lo largo de los años](input/images/Paro_Sexo.png)


CONCLUSIÓN:
Podemos obsevar como la tasa de paro en mujeres es mayor respecto a la tasa de paro en hombres, durante todos los años estudiados, es decir, desde 2006 a 2021. Sin embargo, podemos observar como al principio de los años, esta diferencia de tasas entre ambos sexos era bastante más notable. A partir de la crisis de 2009, podemos observar cómo ambas tasas comienzan a acercarse, hasta 2016, donde empiezan a separarse de nuevo. Hoy en día, la diferencia sigue siendo notable. 
Esto podemos observarlo más rápidamente con la regresión lineal, en la cual vemos como la tasa de par de las mujeres está siempre por encima de la de los hombres.


Por otro lado, para el objetivo de VARIACION DE PARO RESPECTO A LOS AÑOS, AL SEXO Y A COMUNIDAD AUTONOMA, necesitamos un gráfico que nos muestre el paro respecto a hombres y mujeres, a lo largo del tiempo, diferenciando por comunidades autónomas.
Para ello hicimos lo siguiente:

tuvimos que filtrar los datos, para que, en este caso, nos quitaran las final que incluían "total Nacional", ya que, necesitábamos saber la tasa de paro de cada una de las comunidades de las que consta España
```{r , eval = FALSE}
Tasa_de_Paro_CCAA <-
  Tasa_de_Paro %>%
  mutate(`CCAA` = Tasa_de_Paro$`CCAA`) %>%
  filter(`CCAA` != is.na(CCAA) ) %>%
  droplevels()

```

Y realizamos el gráfico:
```{r , eval = FALSE}
Plot_Paro_CCAA <- ## necesitamos guardarlo con un nombre determinado
  ggplot(data = Tasa_de_Paro_CCAA, aes(x = Periodo, y = Total)) +
  geom_point(aes(colour = factor(Sexo))) +
  facet_grid(Sexo ~ Tasa_de_Paro_CCAA$`CCAA`) +
  geom_smooth(method = "lm", aes(colour = factor(Sexo))) +
  theme_light() + #quitamos el gris de fondo
  theme_classic()  #quitamos los cuadrados del fondo

Plot_Paro_CCAA

```

![Imagen 4. Gráfico del paro respecto a cada Comunidad Autónoma](input/images/Paro_CCAA.png)

CONCLUSIÓN:
Podemos observar cómo hay diferencias considerables entre las diferentes comunidades autónomas, pero, las tasas de paro de ambos sexos parecen estar correlacionadas, ya que se asemejan entre comunidades autónomas, a pesar de que en mujeres son algo más elevadas que en hombres; por ejemplo, si nos fijamos en la comunidad autónoma de Andalucía, podemos ver que ambas tasas de paro son las mayores con respecto a las demás; así como en la comunidad de Aragón, ambas tasas descienden con respecto a la de Andalucía. Sin embargo, no es siempre así, porque si nos fijamos en la Comunidad valenciana y País Vasco, se puede observar cómo la tasa de paro de mujeres es mayor en la Comunidad Valenciana, sin embargo, la tasa de paro en hombres es mayor en el País Vasco, por lo que confirmamos que no hay una correlacón precisa, pero sí que van a la vez.


Para el objetivo de VARIACIÓN DE SUICIDIO RESPECTO AL SEXO POR AÑOS, tuvimos que modificar los datos de suicidios para que indicaran aquellos aspectos de interés:

1. Al igual que en el anterior set de datos, cambiamos el nombre de las comunidades y ciudades autónomas, y añadimos los nuevos nombres dados, a una columna nueva  del set de datos que llamaremos CCAA.
Para ello tuvimos que utilizar case_when:

```{r , eval = FALSE}
## Modificamos el nombre de las comunidades autónomas, y los añadimos a una nueva columna, que llamaremos CCAA
Suicidio <- Suicidio%>%
  mutate(
    CCAA = case_when( ## cambiamos el nombre con case_when
      Suicidio$`Comunidades y Ciudades Autónomas`== "Andalucía" ~ "Andalucia",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Aragón" ~ "Aragon",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Asturias, Principado de" ~ "Asturias",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Balears, Illes" ~ "Baleares",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Canarias" ~ "Canarias",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Cantabria" ~ "Cantabria",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Castilla y León" ~ "CyL",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Castilla-La Mancha" ~ "Castilla la Mancha",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Cataluña" ~ "Cataluña",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Comunitat Valenciana" ~ "C.Valencia",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Extremadura" ~ "Extremadura",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Galicia" ~ "Galicia",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Madrid, Comunidad de" ~ "Madrid",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Murcia, Región de" ~ "Murcia",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Navarra, Comunidad Foral de" ~ "Navarra",
      Suicidio$`Comunidades y Ciudades Autónomas`== "País Vasco" ~ "País Vasco",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Rioja, La" ~ "La Rioja",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Ceuta" ~ "Ceuta",
      Suicidio$`Comunidades y Ciudades Autónomas`== "Melilla" ~ "Melilla",
    )) ## y le damos un "nuevo" nombre a cada comunidad
```

2. Filtramos el set de datos para que nos salieran sólo aquellas causas de muerte que correspondían con suicidio y/o lesiones autoinflingidas (debido a que el set de datos era tan extenso, que recogía el número de muertes debidas a otras causas, pero como en nuestro seminario queríamos hablar del suicidio, cogimos aquellos datos que nos interesaban)

```{r , eval = FALSE}
Suicidio <-
  Suicidio %>%
  mutate(`Causa de muerte (lista reducida)` = Suicidio$`Causa de muerte (lista reducida)`) %>%
  filter(`Causa de muerte (lista reducida)` == "098 Suicidio y lesiones autoinfligidas" ) %>%
  droplevels()
```

3. Posteriormente, al igual que en el set de datos de tasa de paro, tuvimos que filtrar para que nos salieran aquellos datos que mostraran hombres y mujeres, ambos por separados, y eliminara aquellos datos que unían ambos sexos. Hicimos esto porque nos interesaba estudiar cuál era el número de suicidios de hombres y de mujeres, ambos por separado, para, posteriormente, compararlos y establecer conclusiones.

```{r , eval = FALSE}
Suicidio <-
  Suicidio %>%
  mutate( Sexo = Suicidio$Sexo) %>%
  filter(Sexo != "Total") %>%
  droplevels() 
```

4. Asimismo, tuvimos que filtrar los datos anteriores, porque, al ser el set de datos tan largo y extenso, recogía información relacionada con el lugar de ocurrencia en el que se había desarrollado la muerte, pero, como no era objetivo de estudio de nuestro seminario, tuvimos que filtrar los datos para que nos mostrará lugar de ocurrencia "Total".


```{r , eval = FALSE}
Suicidio <-
  Suicidio %>%
  mutate(`Lugar de ocurrencia`= Suicidio$`Lugar de ocurrencia` ) %>%
  filter(`Lugar de ocurrencia` == "Total") %>%
  droplevels()
```

5. Finalmente, como vimos que el set de datos tenía algún valor no definido (NA), y que lo estábamos arrastrando de los anteriores filtros, tuvimos que eliminar todas las líneas que tuvieran algún valor NA en ellas, ya que ese valor nos produciría problemas más adelante.

```{r , eval = FALSE}
Suicidio <-
  na.omit(Suicidio)
```

Posteriormente, con los datos bein organizados y filtrados, nos propusimos el objetivo de realizar las gráficas que dependieran del set de datos de suicidio:

Para la VARIACIÓN DE SUICIDIO RESPECTO AL SEXO Y AL TIEMPO, necesitabamos una gráfica en la que nos mostrara todos los casos de suicidios, tanto de hombres como de mujeres, por cada uno de los años.
Para ello:

Creamos un nuevo objeto (Suicidio_Total), en el que incluimos la media del total de suicidios que se han producido en cada año, y la desviación, respecto de la media, del numero total de suicidios.
```{r , eval = FALSE}
Suicidio_Total <-
  Suicidio %>%
  group_by(año, Sexo)%>%
  summarise(MT = mean (Total),
            Year = unique(año),
            desviacion = sd(Total))
```

Y procedemos a realizar la gráfica:
```{r , eval = FALSE}
library(ggplot2)
Plot_Suicidio_Total_Sexo_Año <-  
  ggplot(data = Suicidio_Total, aes(x = Year, y = MT, fill = Sexo))+
  geom_bar( stat = "identity", position = "dodge")+
  geom_errorbar(aes(ymin = MT- desviacion, ymax = MT + desviacion), width=.2,
  position=position_dodge(.9) )   

Plot_Suicidio_Total_Sexo_Año 
```

![Imagen 4. Gráfico del suicidio respecto al sexo](input/images/Suicidio_Sexo.png)


CONCLUSIÓN:
En la tercera de las gráficas, podemos observar claramente cómo el número de suicidios en todos los años estudiados (2016-2020) es mayor en el sexo masculino que en el sexo femenino. Además, hemos representado la desviación estándar con una línea sobre las barras, de lo que deducimos que hay gran variedad en el número de suicidios.  


Para el objetivo de VARIACION DE SUICIDIOS RESPECTO A LOS AÑOS, AL SEXO Y A COMUNIDAD AUTONOMA, necesitábamos una grafica en la que nos mostrara todos los casos de suicidios, tanto de hombres como de mujeres, por cada uno de los años en cada una de las comunidades autónomas de España.
Para ello:
```{r , eval = FALSE}
library(ggplot2)
Plot_Suicidio_CCAA <-
  ggplot(data = Suicidio, aes(x = año, y = Total)) +
  geom_point(aes(colour = factor(Sexo))) +
  facet_grid(Sexo ~ Suicidio$CCAA) +
  geom_smooth(method = "lm", aes(colour = factor(Sexo))) +
  theme_light() + #quitamos el gris de fondo
  theme_classic()  #quitar los cuadraditos

Plot_Suicidio_CCAA
```

![Imagen 5. Gráfico del suicidio respecto a Comunidad Autónoma](input/images/Suicidio_CCAA.png)


CONCLUSIÓN:
Podemos observar cómo hay diferencias considerables entre las diferentes comunidades autónomas, pero, el número de suicidios de ambos sexos parecen estar correlacionado, ya que se asemejan entre comunidades autónomas, a pesar de que en hombres son algo más elevadas que en mujeres; por ejemplo, si nos fijamos en la comunidad autónoma de Andalucía, podemos ver que ambos números de suicidio son los más altos, con respecto a las demás; así como en la ciudad de Melilla, ambas tasas descienden con respecto a la de Andalucía. 
En este gráfico hay una cosa que llama la atención, ya que en la ciudad de Ceuta en el número de suicidios de hombres hay un único punto, es decir, solo se ha producido un suicidio a lo largo de todos los años estudiados.


Por último, para el obejtivo de si hay o no RELACIÓN ENTRE LA CANTIDAD DE PARO, Y EL NÚMERO DE SUICIDIOS, necesitamos hacer un join, uniendo ambas tablas
(falta por hacer bien y mejorar)






## Conclusiones y discusión de los resultados finales
Tras analizar todos los aspectos, vemos a simple vista que no hay correlación, ya que la tasa de paro, en cómputo global, es mayor en mujeres que en hombres, y que el número de suicidio es mayor en hombres que en mujeres, pero para asegurarnos procedemos a juntar ambas tablas.

